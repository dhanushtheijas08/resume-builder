generator client {
  provider      = "prisma-client-js"  
  binaryTargets = ["native", "rhel-openssl-3.0.x"]
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @map("_id")
  name          String
  email         String
  emailVerified Boolean   @default(false)
  image         String?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @default(now()) @updatedAt
  sessions      Session[]
  accounts      Account[]
  resumes       Resume[]

  @@unique([email])
  @@map("user")
}

model Session {
  id        String   @id @map("_id")
  expiresAt DateTime
  token     String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  ipAddress String?
  userAgent String?
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@map("session")
}

model Account {
  id                    String    @id @map("_id")
  accountId             String
  providerId            String
  userId                String
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String?
  refreshToken          String?
  idToken               String?
  accessTokenExpiresAt  DateTime?
  refreshTokenExpiresAt DateTime?
  scope                 String?
  password              String?
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt

  @@map("account")
}

model Verification {
  id         String   @id @map("_id")
  identifier String
  value      String
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  @@map("verification")
}

model ResumeTemplate {
  id              String   @id @default(auto()) @map("_id") @db.ObjectId
  title           String
  company         String
  experience      Float
  metaData        String?
  role            String
  location        String
  previewImageUrl String
  link            String
  tags            String[]
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  resumes Resume[]

  @@map("resumeTemplate")
}

model Resume {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  title String

  templateId String         @db.ObjectId
  template   ResumeTemplate @relation(fields: [templateId], references: [id])

  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  profileId String?  @db.ObjectId
  profile   Profile? @relation(fields: [profileId], references: [id], onDelete: Cascade)

  workExperiences WorkExperience[]
  educations      Education[]
  skills          Skill[]
  projects        Project[]
  certifications  Certification[]
  awards          Award?
  publications    Publication[]
  customSection   CustomSection[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  exportedResumeUrl String?
  lastExportedAt DateTime?
  sectionOrder String[]

  @@map("resume")
}

model Profile {
  id          String @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  designation String
  bio         String
  phoneNumber String
  email       String
  location    String

  profileImage String?
  github       String?
  linkedin     String?
  portfolio    String?
  resumes      Resume[]

  @@map("profile")
}

model WorkExperience {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  order       Int
  jobTitle    String
  company     String
  location    String?
  timePeriod  String?
  description String?

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("workExperience")
}

model Education {
  id    String @id @default(auto()) @map("_id") @db.ObjectId
  order Int

  degree      String
  institution String
  location    String?                                                                     
  timePeriod  String?
  description String?

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("education")
}

model Skill {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  name        String
  proficiency Int? @default(0)
  category    String? @default("Others")
  displayType String  @default("badge") // "badge" | "progress" | "category"

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("skill")
}


model Project {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  order        Int
  name         String
  description  String?
  url          String?
  github       String?
  technologies String[] @default([])
  timePeriod   String?

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("project")
}

model Certification {
  id            String  @id @default(auto()) @map("_id") @db.ObjectId
  order         Int
  title         String
  issuer        String
  credentialUrl String?
  description   String?

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("certification")
}

model Publication {
  id        String  @id @default(auto()) @map("_id") @db.ObjectId
  order     Int
  title     String
  publisher String
  url       String?
  summary   String?

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("publication")
}

model Award {
  id          String  @id @default(auto()) @map("_id") @db.ObjectId
  description String

  resumeId String @unique @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("award")
}

model CustomSection {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  title       String   
  type        SectionType 
  order       Int
  content     Json   

  resumeId String @db.ObjectId
  resume   Resume @relation(fields: [resumeId], references: [id], onDelete: Cascade)
  @@map("customSection")
}

enum SectionType {
  SUMMARY
  EXPERIENCE
  EDUCATION
  PROJECT
  SKILL
  CERTIFICATION
  AWARD
  PUBLICATION
}